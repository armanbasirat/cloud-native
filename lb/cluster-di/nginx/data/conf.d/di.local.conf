upstream k8s-di-backend {
         ip_hash;
         server wrkr1:443;
         server wrkr2:443;
         server wrkr3:443;
         server wrkr4:443;
}

server {

        listen 80;
        listen 443 ssl;
        error_page   403  /403.html;
        server_name *.di.local;
        ssl_certificate /certs/di.local.crt;
        ssl_certificate_key /certs/di.local.key;
        ssl_protocols TLSv1.2;
        access_log /var/log/nginx/di.local.log main;



        location = /403.html {
                 root   /var/www/html;
        }

        location / {


                 proxy_read_timeout 3600s;
                 proxy_send_timeout 900s;
                 proxy_connect_timeout 900s;

                 proxy_set_header Host                  $host;
                 proxy_set_header X-Real-IP             $remote_addr;
                 proxy_set_header X-Forwarded-For       $proxy_add_x_forwarded_for;
                 proxy_set_header X-Forwarded-Proto     $scheme;

                 proxy_set_header Upgrade               $http_upgrade;
                 proxy_set_header Connection "upgrade";

                 proxy_http_version 1.1;


                 proxy_pass https://k8s-di-backend;


        }
}